name: Build DSi Project

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    container: devkitpro/devkitarm:latest
    env:
      DEVKITPRO: /opt/devkitpro
      DEVKITARM: /opt/devkitpro/devkitARM
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Instal dependencies
        run: |
          dkp-pacman -Scc
          dkp-pacman -Syy --noconfirm
          dkp-pacman -S --noconfirm nds-dev libnds

      - name: Listar archivos de devkitPro (Mapa de carpetas)
        run: |
          echo "--- EXPLORANDO /opt/devkitpro ---"
          find /opt/devkitpro -maxdepth 4 -not -path '*/.*'
          echo "--- BUSCANDO default.elf EN TODO EL SISTEMA ---"
          find / -name "default.elf" 2>/dev/null || echo "No se encontró el
          archivo en ningún lado"

      - name: Compile project
        run: |
          export PATH=$DEVKITARM/bin:$PATH
          make -j$(nproc)
        shell: bash

      - name: Upload Build Artifact
        uses: actions/upload-artifact@v4
        with:
          name: 'N$DS64'
          path: "**/*.nds"
          if-no-files-found: warn
      - name: Release NDS Rom
        uses: softprops/action-gh-release@v1
        if: github.ref == 'refs/heads/main'
        with:
          files: ./*.nds
          tag_name: latest
          name: "N-DS64 Ultima Compilación"
          body: "nothing"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

